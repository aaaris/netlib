{"ast":null,"code":"import _asyncToGenerator from \"D:/Work/Project/LMS/lms/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport \"core-js/modules/es.array.splice.js\";\nimport \"regenerator-runtime/runtime.js\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nexport default {\n  data: function data() {\n    return {\n      // 查询建议\n      suggestionArray: [],\n      searchText: \"\",\n      // 查询排行榜表单数据\n      tableData: [],\n      //编辑界面数据\n      curEditIndex: 0,\n      editDialogFormVisible: false,\n      editDialogForm: {}\n    };\n  },\n  created: function created() {\n    var _this = this;\n\n    return _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee() {\n      var _yield$_this$$http$ge, res, _yield$_this$$http$ge2, _res;\n\n      return regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return _this.$http.get(\"/book\");\n\n            case 2:\n              _yield$_this$$http$ge = _context.sent;\n              res = _yield$_this$$http$ge.data;\n              _this.tableData = res.data;\n\n              if (!_this.isLogin) {\n                _context.next = 12;\n                break;\n              }\n\n              _context.next = 8;\n              return _this.$http.get(\"/book/\" + _this.$store.state.userinfo.userid);\n\n            case 8:\n              _yield$_this$$http$ge2 = _context.sent;\n              _res = _yield$_this$$http$ge2.data;\n              console.log(_res);\n              _this.$store.state.userinfo = _res.data;\n\n            case 12:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }))();\n  },\n  methods: {\n    // 获取搜索建议\n    querySearch: function querySearch(queryString, cb) {\n      var _this2 = this;\n\n      return _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee2() {\n        var _yield$_this2$$http, res;\n\n        return regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                _context2.next = 2;\n                return _this2.$http({\n                  method: \"get\",\n                  url: \"/book/suggestion?queryKey=\" + (_this2.select != \"\" ? _this2.select : \"book_name\") + \"&queryVal=\" + queryString\n                });\n\n              case 2:\n                _yield$_this2$$http = _context2.sent;\n                res = _yield$_this2$$http.data;\n                // 调用callback返回建议的数据\n                cb(res.data);\n\n              case 5:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2);\n      }))();\n    },\n    // 寻找书本\n    searchBookItem: function searchBookItem() {\n      var _this3 = this;\n\n      return _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee3() {\n        var _yield$_this3$$http, res;\n\n        return regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                if (!(_this3.select === \"\")) {\n                  _context3.next = 4;\n                  break;\n                }\n\n                return _context3.abrupt(\"return\", _this3.$message.error(\"请选择搜索类别\"));\n\n              case 4:\n                if (!(_this3.searchText === \"\")) {\n                  _context3.next = 6;\n                  break;\n                }\n\n                return _context3.abrupt(\"return\", _this3.$message.error(\"请输入搜索内容\"));\n\n              case 6:\n                _context3.next = 8;\n                return _this3.$http({\n                  method: \"get\",\n                  url: \"/book\" + \"?\" + _this3.select + \"=\" + _this3.searchText\n                });\n\n              case 8:\n                _yield$_this3$$http = _context3.sent;\n                res = _yield$_this3$$http.data;\n\n                if (res.code === 200) {\n                  _this3.tableData = res.data;\n\n                  _this3.$message.success(\"搜索成功\");\n                } else {\n                  _this3.$message.error(\"搜索失败\");\n                }\n\n              case 11:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3);\n      }))();\n    },\n    // 下载书本\n    downloadBookItem: function downloadBookItem(index, row) {\n      var downloadURL = row.book_img_url;\n      row.book_dl_count++;\n      window.open(downloadURL, \"_blank\");\n    },\n    // 编辑书本信息\n    editBookItem: function editBookItem(index, row) {\n      // 获取表单信息，弹出编辑对话框\n      this.curEditIndex = index;\n      this.editDialogFormVisible = true;\n      this.editDialogForm = Object.assign({}, row);\n    },\n    // 编辑对话框对话表单提交\n    editDialogFormSubmit: function editDialogFormSubmit() {\n      var _this4 = this;\n\n      return _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee4() {\n        var _yield$_this4$$http, res;\n\n        return regeneratorRuntime.wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                _context4.next = 2;\n                return _this4.$http({\n                  method: \"put\",\n                  url: \"/book/\" + _this4.editDialogForm.book_id + \"?access_token=\" + _this4.$store.getters.getToken,\n                  data: _this4.editDialogForm\n                });\n\n              case 2:\n                _yield$_this4$$http = _context4.sent;\n                res = _yield$_this4$$http.data;\n\n                _this4.takeData.splice(_this4.curEditIndex, 1, res.data);\n\n                _this4.editDialogFormVisible = false;\n\n                _this4.$message.success(\"修改成功\");\n\n              case 7:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, _callee4);\n      }))();\n    }\n  }\n};","map":{"version":3,"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA6FA;EACAA,IADA,kBACA;IACA;MACA;MACAC,mBAFA;MAGAC,cAHA;MAIA;MACAC,aALA;MAMA;MACAC,eAPA;MAQAC,4BARA;MASAC;IATA;EAWA,CAbA;EAcAC,OAdA,qBAcA;IAAA;;IAAA;MAAA;;MAAA;QAAA;UAAA;YAAA;cAAA;cAAA,OAEA,wBAFA;;YAAA;cAAA;cAEAC,GAFA,yBAEAR,IAFA;cAGA;;cAHA,KAIA,aAJA;gBAAA;gBAAA;cAAA;;cAAA;cAAA,OAKA,gBACA,6CADA,CALA;;YAAA;cAAA;cAKAQ,IALA,0BAKAR,IALA;cAQAS;cACA;;YATA;YAAA;cAAA;UAAA;QAAA;MAAA;IAAA;EAWA,CAzBA;EA0BAC;IACA;IACAC,WAFA,uBAEAC,WAFA,EAEAC,EAFA,EAEA;MAAA;;MAAA;QAAA;;QAAA;UAAA;YAAA;cAAA;gBAAA;gBAAA,OAGA;kBACAC,aADA;kBAEAC,KACA,gCACA,iDADA,IAEA,YAFA,GAGAH;gBANA,EAHA;;cAAA;gBAAA;gBAGAJ,GAHA,uBAGAR,IAHA;gBAWA;gBACAa;;cAZA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IAaA,CAfA;IAiBA;IACAG,cAlBA,4BAkBA;MAAA;;MAAA;QAAA;;QAAA;UAAA;YAAA;cAAA;gBAAA,MACA,oBADA;kBAAA;kBAAA;gBAAA;;gBAAA,kCAEA,gCAFA;;cAAA;gBAAA,MAGA,wBAHA;kBAAA;kBAAA;gBAAA;;gBAAA,kCAIA,gCAJA;;cAAA;gBAAA;gBAAA,OAMA;kBACAF,aADA;kBAEAC;gBAFA,EANA;;cAAA;gBAAA;gBAMAP,GANA,uBAMAR,IANA;;gBAUA;kBACA;;kBACA;gBACA,CAHA,MAGA;kBACA;gBACA;;cAfA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IAgBA,CAlCA;IAmCA;IACAiB,gBApCA,4BAoCAC,KApCA,EAoCAC,GApCA,EAoCA;MACA;MACAA;MACAC;IACA,CAxCA;IAyCA;IACAC,YA1CA,wBA0CAH,KA1CA,EA0CAC,GA1CA,EA0CA;MACA;MACA;MACA;MACA;IACA,CA/CA;IAgDA;IACAG,oBAjDA,kCAiDA;MAAA;;MAAA;QAAA;;QAAA;UAAA;YAAA;cAAA;gBAAA;gBAAA,OAEA;kBACAR,aADA;kBAEAC,KACA,WACA,6BADA,GAEA,gBAFA,GAGA,8BANA;kBAOAf;gBAPA,EAFA;;cAAA;gBAAA;gBAEAQ,GAFA,uBAEAR,IAFA;;gBAWA;;gBACA;;gBACA;;cAbA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IAcA;EA/DA;AA1BA","names":["data","suggestionArray","searchText","tableData","curEditIndex","editDialogFormVisible","editDialogForm","created","res","console","methods","querySearch","queryString","cb","method","url","searchBookItem","downloadBookItem","index","row","window","editBookItem","editDialogFormSubmit"],"sourceRoot":"src/components/index/manager","sources":["BookManager.vue"],"sourcesContent":["<template>\r\n  <div>\r\n    <!-- 书本信息表格 -->\r\n    <!-- 信息部分 -->\r\n    <el-table :data=\"tableData\" height=\"650px\">\r\n      <el-table-column\r\n        prop=\"class_name\"\r\n        align=\"center\"\r\n        label=\"类型\"\r\n        width=\"130px\"\r\n      >\r\n      </el-table-column>\r\n      <el-table-column\r\n        prop=\"book_name\"\r\n        align=\"center\"\r\n        label=\"名称\"\r\n        width=\"200px\"\r\n      >\r\n      </el-table-column>\r\n      <el-table-column\r\n        prop=\"book_addr\"\r\n        align=\"center\"\r\n        label=\"出版社\"\r\n        width=\"200px\"\r\n      >\r\n      </el-table-column>\r\n      <el-table-column\r\n        prop=\"book_info\"\r\n        align=\"center\"\r\n        label=\"描述信息\"\r\n        width=\"230px\"\r\n        show-overflow-tooltip\r\n      >\r\n        <!-- 操作部分 -->\r\n      </el-table-column>\r\n      <el-table-column fixed=\"right\" align=\"center\" label=\"操作\">\r\n        <template slot-scope=\"scope\">\r\n          <el-button\r\n            @click=\"downloadBookItem(scope.$index, scope.row)\"\r\n            icon=\"el-icon-download\"\r\n            circle\r\n          ></el-button>\r\n          <el-button\r\n            type=\"primary\"\r\n            icon=\"el-icon-edit\"\r\n            circle\r\n            @click=\"editBookItem(scope.$index, scope.row)\"\r\n          >\r\n          </el-button>\r\n \r\n        </template>\r\n      </el-table-column>\r\n    </el-table>\r\n    <!--编辑界面-->\r\n    <el-dialog\r\n      title=\"编辑书籍\"\r\n      :visible.sync=\"editDialogFormVisible\"\r\n      :close-on-click-modal=\"false\"\r\n      :append-to-body=\"true\"\r\n    >\r\n      <!--editDialogForm表单提交的数据-->\r\n      <el-form :model=\"editDialogForm\" label-width=\"80px\" ref=\"editDialogForm\">\r\n        <el-form-item label=\"类型\" prop=\"class_name\">\r\n          <el-input\r\n            v-model=\"editDialogForm.class_name\"\r\n            auto-complete=\"off\"\r\n          ></el-input>\r\n        </el-form-item>\r\n        <el-form-item label=\"名称\" prop=\"book_name\">\r\n          <el-input\r\n            v-model=\"editDialogForm.book_name\"\r\n            auto-complete=\"off\"\r\n            readonly\r\n          ></el-input>\r\n        </el-form-item>\r\n        <el-form-item label=\"描述信息\" prop=\"book_info\">\r\n          <el-input\r\n            type=\"textarea\"\r\n            v-model=\"editDialogForm.book_info\"\r\n            autosize\r\n          ></el-input>\r\n        </el-form-item>\r\n      </el-form>\r\n      <div slot=\"footer\" class=\"dialog-footer\">\r\n        <el-button @click=\"editDialogFormVisible = false\">取 消</el-button>\r\n        <el-button type=\"primary\" @click=\"editDialogFormSubmit\"\r\n          >确 定</el-button\r\n        >\r\n      </div>\r\n    </el-dialog>\r\n  </div>\r\n</template>\r\n<script>\r\nexport default {\r\n  data() {\r\n    return {\r\n      // 查询建议\r\n      suggestionArray: [],\r\n      searchText: \"\",\r\n      // 查询排行榜表单数据\r\n      tableData: [],\r\n      //编辑界面数据\r\n      curEditIndex: 0,\r\n      editDialogFormVisible: false,\r\n      editDialogForm: {},\r\n    };\r\n  },\r\n  async created() {\r\n    // 从后端api初始化tableData\r\n    const { data: res } = await this.$http.get(\"/book\");\r\n    this.tableData = res.data;\r\n    if (this.isLogin) {\r\n      const { data: res } = await this.$http.get(\r\n        \"/book/\" + this.$store.state.userinfo.userid\r\n      );\r\n      console.log(res);\r\n      this.$store.state.userinfo = res.data;\r\n    }\r\n  },\r\n  methods: {\r\n    // 获取搜索建议\r\n    async querySearch(queryString, cb) {\r\n      // console.log(str)\r\n      // 发送后台请求获取搜索建议\r\n      const { data: res } = await this.$http({\r\n        method: \"get\",\r\n        url:\r\n          \"/book/suggestion?queryKey=\" +\r\n          (this.select != \"\" ? this.select : \"book_name\") +\r\n          \"&queryVal=\" +\r\n          queryString,\r\n      });\r\n      // 调用callback返回建议的数据\r\n      cb(res.data);\r\n    },\r\n\r\n    // 寻找书本\r\n    async searchBookItem() {\r\n      if (this.select === \"\") {\r\n        return this.$message.error(\"请选择搜索类别\");\r\n      } else if (this.searchText === \"\") {\r\n        return this.$message.error(\"请输入搜索内容\");\r\n      }\r\n      const { data: res } = await this.$http({\r\n        method: \"get\",\r\n        url: \"/book\" + \"?\" + this.select + \"=\" + this.searchText,\r\n      });\r\n      if (res.code === 200) {\r\n        this.tableData = res.data;\r\n        this.$message.success(\"搜索成功\");\r\n      } else {\r\n        this.$message.error(\"搜索失败\");\r\n      }\r\n    },\r\n    // 下载书本\r\n    downloadBookItem(index, row) { \r\n      let downloadURL = row.book_img_url;\r\n      row.book_dl_count++;\r\n      window.open(downloadURL, \"_blank\");\r\n    },\r\n    // 编辑书本信息\r\n    editBookItem(index, row) { \r\n      // 获取表单信息，弹出编辑对话框\r\n      this.curEditIndex = index;\r\n      this.editDialogFormVisible = true;\r\n      this.editDialogForm = Object.assign({}, row);\r\n    },\r\n    // 编辑对话框对话表单提交\r\n    async editDialogFormSubmit() {\r\n      // 向后台提交编辑请求\r\n      const { data: res } = await this.$http({\r\n        method: \"put\",\r\n        url:\r\n          \"/book/\" +\r\n          this.editDialogForm.book_id +\r\n          \"?access_token=\" +\r\n          this.$store.getters.getToken,\r\n        data: this.editDialogForm,\r\n      });\r\n      this.takeData.splice(this.curEditIndex, 1, res.data); \r\n      this.editDialogFormVisible = false;\r\n      this.$message.success(\"修改成功\");\r\n    }, \r\n  },\r\n};\r\n</script>\r\n<style lang=\"less\" scoped></style>\r\n"]},"metadata":{},"sourceType":"module"}