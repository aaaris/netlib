{"ast":null,"code":"import _asyncToGenerator from \"D:/Work/Project/LMS/lms/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport \"core-js/modules/es.number.constructor.js\";\nimport \"regenerator-runtime/runtime.js\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport Header from \"../Header.vue\";\nimport Footer from \"../Footer.vue\";\nexport default {\n  components: {\n    Header: Header,\n    Footer: Footer\n  },\n  created: function created() {\n    var _this = this;\n\n    return _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee() {\n      var _yield$_this$$http$ge, res, _yield$_this$$http$ge2, res2, _yield$_this$$http$ge3, res3;\n\n      return regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return _this.$http.get(\"/book/\" + _this.$route.params.book_id);\n\n            case 2:\n              _yield$_this$$http$ge = _context.sent;\n              res = _yield$_this$$http$ge.data;\n              _this.book = res.data; // console.log(this.book);\n              // 从后端api初始化books data\n\n              _context.next = 7;\n              return _this.$http.get(\"/book\" + \"?limit=10\");\n\n            case 7:\n              _yield$_this$$http$ge2 = _context.sent;\n              res2 = _yield$_this$$http$ge2.data;\n              _this.recommendBooks = res2.data; // console.log(this.recommendBooks);\n              // 从后端api初始化comment data\n\n              _context.next = 12;\n              return _this.$http.get(\"/comment/\" + _this.book.book_id);\n\n            case 12:\n              _yield$_this$$http$ge3 = _context.sent;\n              res3 = _yield$_this$$http$ge3.data;\n              _this.comments = res3.data;\n              console.log(_this.comments);\n\n            case 16:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }))();\n  },\n  data: function data() {\n    return {\n      // post页图书\n      book: {\n        book_addr: \"\",\n        book_author: \"\",\n        book_date: \"\",\n        book_dl_count: \"\",\n        book_id: \"\",\n        book_img_url: \"\",\n        book_info: \"\",\n        book_name: \"\",\n        book_score: \"\",\n        class_name: \"\"\n      },\n      // 推荐图书集\n      recommendBooks: [],\n      // 评论集合\n      comments: [],\n      // 输入评论\n      input_comment: \"\"\n    };\n  },\n  computed: {\n    // 计算评分 数据库数据范围是10，而组件范围是5\n    book_rate: {\n      get: function get() {\n        return this.book.book_score * 0.5;\n      }\n    }\n  },\n  methods: {\n    // 下载图书\n    downloadBook: function downloadBook() {\n      // 检查用户是否登陆\n      if (!this.$store.state.isLogin) {\n        this.$router.push(\"/login\");\n        return this.$message.error(\"请先登陆\");\n      }\n\n      alert(\"只有图片捏！\");\n    },\n    // 收藏图书\n    collectBook: function collectBook() {\n      var _this2 = this;\n\n      return _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee2() {\n        var _yield$_this2$$http, res;\n\n        return regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                if (_this2.$store.state.isLogin) {\n                  _context2.next = 3;\n                  break;\n                }\n\n                _this2.$router.push(\"/login\");\n\n                return _context2.abrupt(\"return\", _this2.$message.error(\"请先登陆\"));\n\n              case 3:\n                _context2.next = 5;\n                return _this2.$http({\n                  method: \"post\",\n                  url: \"/collection?access_token=\" + _this2.$store.getters.getToken,\n                  data: {\n                    user_id: Number(_this2.$store.getters.getUserId),\n                    book_id: book.book_id\n                  }\n                });\n\n              case 5:\n                _yield$_this2$$http = _context2.sent;\n                res = _yield$_this2$$http.data;\n\n                if (res.code == 200) {\n                  _this2.$message.sucess(\"收藏成功！\");\n                } else {\n                  alert(res.data);\n                }\n\n              case 8:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2);\n      }))();\n    },\n    // 发布评论\n    sendComment: function sendComment() {\n      var _this3 = this;\n\n      return _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee3() {\n        var _yield$_this3$$http, res;\n\n        return regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                if (!(_this3.input_comment === \"\")) {\n                  _context3.next = 3;\n                  break;\n                }\n\n                alert(\"评论不能为空\");\n                return _context3.abrupt(\"return\");\n\n              case 3:\n                _context3.next = 5;\n                return _this3.$http({\n                  method: \"post\",\n                  url: \"/comment\",\n                  data: {\n                    user_id: _this3.$store.getters.getUserId,\n                    book_id: _this3.book.book_id,\n                    comment_text: _this3.input_comment\n                  }\n                });\n\n              case 5:\n                _yield$_this3$$http = _context3.sent;\n                res = _yield$_this3$$http.data;\n                console.log(res);\n\n                if (res.code === 200) {\n                  _this3.$message.success(\"评论发表成功！\");\n                } else {\n                  _this3.$message.error(res.data);\n                }\n\n              case 9:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3);\n      }))();\n    }\n  }\n};","map":{"version":3,"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAiJA;AACA;AACA;EACAA;IAAAC;IAAAC;EAAA,CADA;EAEAC,OAFA,qBAEA;IAAA;;IAAA;MAAA;;MAAA;QAAA;UAAA;YAAA;cAAA;cAAA,OACA,gBACA,sCADA,CADA;;YAAA;cAAA;cACAC,GADA,yBACAC,IADA;cAIA,sBAJA,CAKA;cACA;;cANA;cAAA,OAOA,sCAPA;;YAAA;cAAA;cAOAC,IAPA,0BAOAD,IAPA;cAQA,iCARA,CASA;cACA;;cAVA;cAAA,OAWA,gBACA,gCADA,CAXA;;YAAA;cAAA;cAWAE,IAXA,0BAWAF,IAXA;cAcA;cACAG;;YAfA;YAAA;cAAA;UAAA;QAAA;MAAA;IAAA;EAgBA,CAlBA;EAmBAH,IAnBA,kBAmBA;IACA;MACA;MACAI;QACAC,aADA;QAEAC,eAFA;QAGAC,aAHA;QAIAC,iBAJA;QAKAC,WALA;QAMAC,gBANA;QAOAC,aAPA;QAQAC,aARA;QASAC,cATA;QAUAC;MAVA,CAFA;MAcA;MACAC,kBAfA;MAgBA;MACAC,YAjBA;MAkBA;MACAC;IAnBA;EAqBA,CAzCA;EA0CAC;IACA;IACAC;MACAC,GADA,iBACA;QACA;MACA;IAHA;EAFA,CA1CA;EAkDAC;IACA;IACAC,YAFA,0BAEA;MACA;MACA;QACA;QACA;MACA;;MACAC;IACA,CATA;IAUA;IACAC,WAXA,yBAWA;MAAA;;MAAA;QAAA;;QAAA;UAAA;YAAA;cAAA;gBAAA,IACA,2BADA;kBAAA;kBAAA;gBAAA;;gBAEA;;gBAFA,kCAGA,6BAHA;;cAAA;gBAAA;gBAAA,OAKA;kBACAC,cADA;kBAEAC,iEAFA;kBAGA1B;oBACA2B,gDADA;oBAEAlB;kBAFA;gBAHA,EALA;;cAAA;gBAAA;gBAKAV,GALA,uBAKAC,IALA;;gBAaA;kBACA;gBACA,CAFA,MAEA;kBACAuB;gBACA;;cAjBA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IAkBA,CA7BA;IA8BA;IACAK,WA/BA,yBA+BA;MAAA;;MAAA;QAAA;;QAAA;UAAA;YAAA;cAAA;gBAAA,MACA,2BADA;kBAAA;kBAAA;gBAAA;;gBAEAL;gBAFA;;cAAA;gBAAA;gBAAA,OAKA;kBACAE,cADA;kBAEAC,eAFA;kBAGA1B;oBACA2B,wCADA;oBAEAlB,4BAFA;oBAGAoB;kBAHA;gBAHA,EALA;;cAAA;gBAAA;gBAKA9B,GALA,uBAKAC,IALA;gBAcAG;;gBACA;kBACA;gBACA,CAFA,MAEA;kBACA;gBACA;;cAnBA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IAoBA;EAnDA;AAlDA","names":["components","Header","Footer","created","res","data","res2","res3","console","book","book_addr","book_author","book_date","book_dl_count","book_id","book_img_url","book_info","book_name","book_score","class_name","recommendBooks","comments","input_comment","computed","book_rate","get","methods","downloadBook","alert","collectBook","method","url","user_id","sendComment","comment_text"],"sourceRoot":"src/components/books","sources":["Book.vue"],"sourcesContent":["<template>\r\n  <div>\r\n    <Header></Header>\r\n    <div class=\"main-container\">\r\n      <!-- 书本基本介绍 -->\r\n      <el-card class=\"box-card\">\r\n        <div slot=\"header\" class=\"clearfix\">\r\n          <span class=\"header_name\">{{ book.book_name }}</span>\r\n          <div style=\"float: right; padding: 3px 0\" type=\"text\">\r\n            <i class=\"el-icon-time\">{{ book.book_date }}</i>\r\n            <!-- <i class=\"el-icon-user\">book.book_upload_user</i> -->\r\n          </div>\r\n        </div>\r\n        <div class=\"book_info\">\r\n          <img\r\n            width=\"150px\"\r\n            :src=\"\r\n              `http://localhost:8081/static/img/books/` +\r\n              this.book.book_img_url.split('/').at(-1)\r\n            \"\r\n            alt=\"书本图片\"\r\n          />\r\n          <div class=\"book_info_text\">\r\n            书籍名称：<span style=\"color: #333\">《{{ book.book_name }}》</span>\r\n            <br />\r\n            所属分类： <span style=\"color: #333\">{{ book.class_name }}</span\r\n            ><br />\r\n            书籍作者：<span style=\"color: #333\">{{ book.book_author }}</span\r\n            ><br />\r\n            书籍出版社： <span style=\"color: #333\">{{ book.book_addr }}</span\r\n            ><br />\r\n            <el-rate\r\n              v-model=\"book_rate\"\r\n              disabled\r\n              show-score\r\n              text-color=\"#ff9900\"\r\n              score-template=\"{value}\"\r\n            >\r\n            </el-rate>\r\n          </div>\r\n        </div>\r\n        <!-- 用户操作按钮 -->\r\n        <div style=\"margin-top: 30px\">\r\n          <el-button\r\n            style=\"width: 150px\"\r\n            icon=\"el-icon-download\"\r\n            @click=\"downloadBook\"\r\n            >下载</el-button\r\n          >\r\n          &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\r\n          <el-button type=\"warning\" icon=\"el-icon-star-off\" @click=\"collectBook\"\r\n            >收藏</el-button\r\n          >\r\n        </div>\r\n      </el-card>\r\n      <!-- 内容简介 -->\r\n      <el-card class=\"box-card\">\r\n        <div slot=\"header\" class=\"clearfix\">\r\n          <span class=\"header_name\">内容简介</span>\r\n        </div>\r\n        <div class=\"text item\">\r\n          <p>\r\n            {{ book.book_info }}\r\n          </p>\r\n        </div>\r\n      </el-card>\r\n      <!-- 相关推荐(同类型+同作者) -->\r\n      <el-card class=\"box-card\">\r\n        <div slot=\"header\" class=\"clearfix\">\r\n          <span class=\"header_name\">相关推荐</span>\r\n        </div>\r\n        <div style=\"text-align: center\">\r\n          <div class=\"book_item\" v-for=\"rb in recommendBooks\">\r\n            <a :href=\"`/book/` + rb.book_id\">\r\n              <img\r\n                :src=\"\r\n                  `http://localhost:8081/static/img/books/` +\r\n                  rb.book_img_url.split('/').at(-1)\r\n                \"\r\n                alt=\"书本图片\"\r\n              />\r\n            </a>\r\n          </div>\r\n        </div>\r\n      </el-card>\r\n      <!-- 评论列表 -->\r\n      <el-card class=\"box-card\">\r\n        <div slot=\"header\" class=\"clearfix\">\r\n          <span class=\"header_name\">评论列表</span>\r\n        </div>\r\n        <div class=\"comment-item\" v-if=\"this.comments.length === 0\">\r\n          😊 暂无评论，快来抢沙发吧~\r\n        </div>\r\n        <div class=\"comment-item\" v-for=\"comment in this.comments\">\r\n          <div\r\n            style=\"\r\n              color: #4e86bd;\r\n              padding-bottom: 10px;\r\n              display: flex;\r\n              align-items: center;\r\n            \"\r\n          >\r\n            <img\r\n              style=\"border-radius: 50%; margin-right: 10px\"\r\n              :src=\"`http://localhost:8081` + comment.user_img_url\"\r\n              height=\"22px\"\r\n              alt=\"\"\r\n            />\r\n            {{ comment.user_name }}\r\n            <div style=\"margin-left: 20px\">\r\n              {{ comment.create_time }}\r\n            </div>\r\n          </div>\r\n          <div>{{ comment.comment_text }}</div>\r\n        </div>\r\n      </el-card>\r\n      <!-- 发表评论 -->\r\n      <el-card class=\"box-card\">\r\n        <div slot=\"header\" class=\"clearfix\">\r\n          <span class=\"header_name\">发表评论</span>\r\n        </div>\r\n        <div class=\"text item\">\r\n          <el-input\r\n            type=\"textarea\"\r\n            :autosize=\"{ minRows: 4, maxRows: 5 }\"\r\n            placeholder=\"请输入内容\"\r\n            v-model=\"input_comment\"\r\n            maxlength=\"50\"\r\n            show-word-limit\r\n          >\r\n          </el-input>\r\n          <el-button\r\n            style=\"width: 150px; margin-top: 20px\"\r\n            icon=\"el-icon-s-comment\"\r\n            type=\"primary\"\r\n            @click=\"sendComment\"\r\n            >发布</el-button\r\n          >\r\n        </div>\r\n      </el-card>\r\n    </div>\r\n    <Footer></Footer>\r\n  </div>\r\n</template>\r\n<script>\r\nimport Header from \"../Header.vue\";\r\nimport Footer from \"../Footer.vue\";\r\nexport default {\r\n  components: { Header, Footer },\r\n  async created() {\r\n    const { data: res } = await this.$http.get(\r\n      \"/book/\" + this.$route.params.book_id\r\n    );\r\n    this.book = res.data;\r\n    // console.log(this.book);\r\n    // 从后端api初始化books data\r\n    const { data: res2 } = await this.$http.get(\"/book\" + `?limit=10`);\r\n    this.recommendBooks = res2.data;\r\n    // console.log(this.recommendBooks);\r\n    // 从后端api初始化comment data\r\n    const { data: res3 } = await this.$http.get(\r\n      \"/comment/\" + this.book.book_id\r\n    );\r\n    this.comments = res3.data;\r\n    console.log(this.comments);\r\n  },\r\n  data() {\r\n    return {\r\n      // post页图书\r\n      book: {\r\n        book_addr: \"\",\r\n        book_author: \"\",\r\n        book_date: \"\",\r\n        book_dl_count: \"\",\r\n        book_id: \"\",\r\n        book_img_url: \"\",\r\n        book_info: \"\",\r\n        book_name: \"\",\r\n        book_score: \"\",\r\n        class_name: \"\",\r\n      },\r\n      // 推荐图书集\r\n      recommendBooks: [],\r\n      // 评论集合\r\n      comments: [],\r\n      // 输入评论\r\n      input_comment: \"\",\r\n    };\r\n  },\r\n  computed: {\r\n    // 计算评分 数据库数据范围是10，而组件范围是5\r\n    book_rate: {\r\n      get() {\r\n        return this.book.book_score * 0.5;\r\n      },\r\n    },\r\n  },\r\n  methods: {\r\n    // 下载图书\r\n    downloadBook() {\r\n      // 检查用户是否登陆\r\n      if (!this.$store.state.isLogin) {\r\n        this.$router.push(\"/login\");\r\n        return this.$message.error(\"请先登陆\");\r\n      }\r\n      alert(\"只有图片捏！\");\r\n    },\r\n    // 收藏图书\r\n    async collectBook() {\r\n      if (!this.$store.state.isLogin) {\r\n        this.$router.push(\"/login\");\r\n        return this.$message.error(\"请先登陆\");\r\n      }\r\n      const { data: res } = await this.$http({\r\n        method: \"post\",\r\n        url: \"/collection?access_token=\" + this.$store.getters.getToken,\r\n        data: {\r\n          user_id: Number(this.$store.getters.getUserId),\r\n          book_id: book.book_id,\r\n        },\r\n      });\r\n      if (res.code == 200) {\r\n        this.$message.sucess(\"收藏成功！\");\r\n      } else {\r\n        alert(res.data);\r\n      }\r\n    },\r\n    // 发布评论\r\n    async sendComment() {\r\n      if (this.input_comment === \"\") {\r\n        alert(\"评论不能为空\");\r\n        return;\r\n      }\r\n      const { data: res } = await this.$http({\r\n        method: \"post\",\r\n        url: \"/comment\",\r\n        data: {\r\n          user_id: this.$store.getters.getUserId,\r\n          book_id: this.book.book_id,\r\n          comment_text: this.input_comment,\r\n        },\r\n      });\r\n      console.log(res);\r\n      if (res.code === 200) {\r\n        this.$message.success(\"评论发表成功！\");\r\n      } else {\r\n        this.$message.error(res.data);\r\n      }\r\n    },\r\n  },\r\n};\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n// 内容容器\r\n.main-container {\r\n  line-height: 30px;\r\n  width: 75%;\r\n  margin: 50px auto;\r\n  // background-color: white;\r\n  // box-shadow: 0 4px 14px 0 rgb(0 0 0 / 5%);\r\n}\r\n\r\n// 书本样式\r\n.book_item {\r\n  display: inline-block;\r\n  width: 162px;\r\n  height: 240px;\r\n  padding: 8px;\r\n  // box-sizing: border-box;\r\n  border: 5px double wheat;\r\n  img {\r\n    height: 100%;\r\n    width: 100%;\r\n  }\r\n}\r\n\r\n.clearfix:before,\r\n.clearfix:after {\r\n  display: table;\r\n  content: \"\";\r\n}\r\n.clearfix:after {\r\n  clear: both;\r\n}\r\n.clearfix {\r\n  color: #666;\r\n  span {\r\n    font-size: 20px;\r\n  }\r\n}\r\n\r\n.box-card {\r\n  // width: 480px;\r\n  margin-top: 30px;\r\n}\r\n\r\n.book_info {\r\n  display: flex;\r\n  align-items: center;\r\n}\r\n\r\n.book_info_text {\r\n  margin-left: 50px;\r\n  color: #888;\r\n}\r\n\r\n.comment-item {\r\n  margin-bottom: 20px;\r\n}\r\n\r\n// 移动端适配\r\n@media (max-width: 600px) {\r\n  .main-container {\r\n    margin: 30px auto;\r\n    width: 90%;\r\n    padding: 10px;\r\n  }\r\n  .book_info {\r\n    flex-direction: column;\r\n  }\r\n  .book_info_text {\r\n    margin-top: 10px;\r\n  }\r\n}\r\n</style>\r\n"]},"metadata":{},"sourceType":"module"}