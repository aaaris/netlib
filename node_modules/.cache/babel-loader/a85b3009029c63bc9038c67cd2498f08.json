{"ast":null,"code":"/*\n\tMIT License http://www.opensource.org/licenses/mit-license.php\n\tAuthor Tobias Koppers @sokra\n*/\n\"use strict\";\n\nvar _slicedToArray = require(\"D:/Work/Project/LMS/lms/node_modules/@babel/runtime/helpers/slicedToArray.js\")[\"default\"];\n\nvar _classCallCheck = require(\"D:/Work/Project/LMS/lms/node_modules/@babel/runtime/helpers/classCallCheck.js\")[\"default\"];\n\nvar _createClass = require(\"D:/Work/Project/LMS/lms/node_modules/@babel/runtime/helpers/createClass.js\")[\"default\"];\n\nvar _createForOfIteratorHelper = require(\"D:/Work/Project/LMS/lms/node_modules/@babel/runtime/helpers/createForOfIteratorHelper.js\")[\"default\"];\n\nrequire(\"core-js/modules/es.array.slice.js\");\n\nrequire(\"core-js/modules/es.map.js\");\n\nrequire(\"core-js/modules/es.object.to-string.js\");\n\nrequire(\"core-js/modules/es.string.iterator.js\");\n\nrequire(\"core-js/modules/web.dom-collections.iterator.js\");\n\nrequire(\"core-js/modules/es.error.cause.js\");\n\nrequire(\"core-js/modules/es.error.to-string.js\");\n\nrequire(\"core-js/modules/es.set.js\");\n\nrequire(\"core-js/modules/es.function.bind.js\");\n\nrequire(\"core-js/modules/es.string.starts-with.js\");\n\nrequire(\"core-js/modules/es.date.now.js\");\n\nrequire(\"core-js/modules/es.date.to-string.js\");\n\nrequire(\"core-js/modules/web.timers.js\");\n\nrequire(\"core-js/modules/es.regexp.to-string.js\");\n\nvar nextTick = require(\"process\").nextTick;\n/** @typedef {import(\"./Resolver\").FileSystem} FileSystem */\n\n/** @typedef {import(\"./Resolver\").SyncFileSystem} SyncFileSystem */\n\n\nvar dirname = function dirname(path) {\n  var idx = path.length - 1;\n\n  while (idx >= 0) {\n    var c = path.charCodeAt(idx); // slash or backslash\n\n    if (c === 47 || c === 92) break;\n    idx--;\n  }\n\n  if (idx < 0) return \"\";\n  return path.slice(0, idx);\n};\n\nvar runCallbacks = function runCallbacks(callbacks, err, result) {\n  if (callbacks.length === 1) {\n    callbacks[0](err, result);\n    callbacks.length = 0;\n    return;\n  }\n\n  var error;\n\n  var _iterator = _createForOfIteratorHelper(callbacks),\n      _step;\n\n  try {\n    for (_iterator.s(); !(_step = _iterator.n()).done;) {\n      var callback = _step.value;\n\n      try {\n        callback(err, result);\n      } catch (e) {\n        if (!error) error = e;\n      }\n    }\n  } catch (err) {\n    _iterator.e(err);\n  } finally {\n    _iterator.f();\n  }\n\n  callbacks.length = 0;\n  if (error) throw error;\n};\n\nvar OperationMergerBackend = /*#__PURE__*/function () {\n  /**\n   * @param {any} provider async method\n   * @param {any} syncProvider sync method\n   * @param {any} providerContext call context for the provider methods\n   */\n  function OperationMergerBackend(provider, syncProvider, providerContext) {\n    var _this = this;\n\n    _classCallCheck(this, OperationMergerBackend);\n\n    this._provider = provider;\n    this._syncProvider = syncProvider;\n    this._providerContext = providerContext;\n    this._activeAsyncOperations = new Map();\n    this.provide = this._provider ? function (path, options, callback) {\n      if (typeof options === \"function\") {\n        callback = options;\n        options = undefined;\n      }\n\n      if (options) {\n        return _this._provider.call(_this._providerContext, path, options, callback);\n      }\n\n      if (typeof path !== \"string\") {\n        callback(new TypeError(\"path must be a string\"));\n        return;\n      }\n\n      var callbacks = _this._activeAsyncOperations.get(path);\n\n      if (callbacks) {\n        callbacks.push(callback);\n        return;\n      }\n\n      _this._activeAsyncOperations.set(path, callbacks = [callback]);\n\n      provider(path, function (err, result) {\n        _this._activeAsyncOperations[\"delete\"](path);\n\n        runCallbacks(callbacks, err, result);\n      });\n    } : null;\n    this.provideSync = this._syncProvider ? function (path, options) {\n      return _this._syncProvider.call(_this._providerContext, path, options);\n    } : null;\n  }\n\n  _createClass(OperationMergerBackend, [{\n    key: \"purge\",\n    value: function purge() {}\n  }, {\n    key: \"purgeParent\",\n    value: function purgeParent() {}\n  }]);\n\n  return OperationMergerBackend;\n}();\n/*\n\nIDLE:\n\tinsert data: goto SYNC\n\nSYNC:\n\tbefore provide: run ticks\n\tevent loop tick: goto ASYNC_ACTIVE\n\nASYNC:\n\ttimeout: run tick, goto ASYNC_PASSIVE\n\nASYNC_PASSIVE:\n\tbefore provide: run ticks\n\nIDLE --[insert data]--> SYNC --[event loop tick]--> ASYNC_ACTIVE --[interval tick]-> ASYNC_PASSIVE\n                                                          ^                             |\n                                                          +---------[insert data]-------+\n*/\n\n\nvar STORAGE_MODE_IDLE = 0;\nvar STORAGE_MODE_SYNC = 1;\nvar STORAGE_MODE_ASYNC = 2;\n\nvar CacheBackend = /*#__PURE__*/function () {\n  /**\n   * @param {number} duration max cache duration of items\n   * @param {any} provider async method\n   * @param {any} syncProvider sync method\n   * @param {any} providerContext call context for the provider methods\n   */\n  function CacheBackend(duration, provider, syncProvider, providerContext) {\n    _classCallCheck(this, CacheBackend);\n\n    this._duration = duration;\n    this._provider = provider;\n    this._syncProvider = syncProvider;\n    this._providerContext = providerContext;\n    /** @type {Map<string, (function(Error, any): void)[]>} */\n\n    this._activeAsyncOperations = new Map();\n    /** @type {Map<string, { err: Error, result: any, level: Set<string> }>} */\n\n    this._data = new Map();\n    /** @type {Set<string>[]} */\n\n    this._levels = [];\n\n    for (var i = 0; i < 10; i++) {\n      this._levels.push(new Set());\n    }\n\n    for (var _i = 5000; _i < duration; _i += 500) {\n      this._levels.push(new Set());\n    }\n\n    this._currentLevel = 0;\n    this._tickInterval = Math.floor(duration / this._levels.length);\n    /** @type {STORAGE_MODE_IDLE | STORAGE_MODE_SYNC | STORAGE_MODE_ASYNC} */\n\n    this._mode = STORAGE_MODE_IDLE;\n    /** @type {NodeJS.Timeout | undefined} */\n\n    this._timeout = undefined;\n    /** @type {number | undefined} */\n\n    this._nextDecay = undefined;\n    this.provide = provider ? this.provide.bind(this) : null;\n    this.provideSync = syncProvider ? this.provideSync.bind(this) : null;\n  }\n\n  _createClass(CacheBackend, [{\n    key: \"provide\",\n    value: function provide(path, options, callback) {\n      var _this2 = this;\n\n      if (typeof options === \"function\") {\n        callback = options;\n        options = undefined;\n      }\n\n      if (typeof path !== \"string\") {\n        callback(new TypeError(\"path must be a string\"));\n        return;\n      }\n\n      if (options) {\n        return this._provider.call(this._providerContext, path, options, callback);\n      } // When in sync mode we can move to async mode\n\n\n      if (this._mode === STORAGE_MODE_SYNC) {\n        this._enterAsyncMode();\n      } // Check in cache\n\n\n      var cacheEntry = this._data.get(path);\n\n      if (cacheEntry !== undefined) {\n        if (cacheEntry.err) return nextTick(callback, cacheEntry.err);\n        return nextTick(callback, null, cacheEntry.result);\n      } // Check if there is already the same operation running\n\n\n      var callbacks = this._activeAsyncOperations.get(path);\n\n      if (callbacks !== undefined) {\n        callbacks.push(callback);\n        return;\n      }\n\n      this._activeAsyncOperations.set(path, callbacks = [callback]); // Run the operation\n\n\n      this._provider.call(this._providerContext, path, function (err, result) {\n        _this2._activeAsyncOperations[\"delete\"](path);\n\n        _this2._storeResult(path, err, result); // Enter async mode if not yet done\n\n\n        _this2._enterAsyncMode();\n\n        runCallbacks(callbacks, err, result);\n      });\n    }\n  }, {\n    key: \"provideSync\",\n    value: function provideSync(path, options) {\n      if (typeof path !== \"string\") {\n        throw new TypeError(\"path must be a string\");\n      }\n\n      if (options) {\n        return this._syncProvider.call(this._providerContext, path, options);\n      } // In sync mode we may have to decay some cache items\n\n\n      if (this._mode === STORAGE_MODE_SYNC) {\n        this._runDecays();\n      } // Check in cache\n\n\n      var cacheEntry = this._data.get(path);\n\n      if (cacheEntry !== undefined) {\n        if (cacheEntry.err) throw cacheEntry.err;\n        return cacheEntry.result;\n      } // Get all active async operations\n      // This sync operation will also complete them\n\n\n      var callbacks = this._activeAsyncOperations.get(path);\n\n      this._activeAsyncOperations[\"delete\"](path); // Run the operation\n      // When in idle mode, we will enter sync mode\n\n\n      var result;\n\n      try {\n        result = this._syncProvider.call(this._providerContext, path);\n      } catch (err) {\n        this._storeResult(path, err, undefined);\n\n        this._enterSyncModeWhenIdle();\n\n        if (callbacks) runCallbacks(callbacks, err, undefined);\n        throw err;\n      }\n\n      this._storeResult(path, undefined, result);\n\n      this._enterSyncModeWhenIdle();\n\n      if (callbacks) runCallbacks(callbacks, undefined, result);\n      return result;\n    }\n  }, {\n    key: \"purge\",\n    value: function purge(what) {\n      if (!what) {\n        if (this._mode !== STORAGE_MODE_IDLE) {\n          this._data.clear();\n\n          var _iterator2 = _createForOfIteratorHelper(this._levels),\n              _step2;\n\n          try {\n            for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {\n              var level = _step2.value;\n              level.clear();\n            }\n          } catch (err) {\n            _iterator2.e(err);\n          } finally {\n            _iterator2.f();\n          }\n\n          this._enterIdleMode();\n        }\n      } else if (typeof what === \"string\") {\n        var _iterator3 = _createForOfIteratorHelper(this._data),\n            _step3;\n\n        try {\n          for (_iterator3.s(); !(_step3 = _iterator3.n()).done;) {\n            var _step3$value = _slicedToArray(_step3.value, 2),\n                key = _step3$value[0],\n                data = _step3$value[1];\n\n            if (key.startsWith(what)) {\n              this._data[\"delete\"](key);\n\n              data.level[\"delete\"](key);\n            }\n          }\n        } catch (err) {\n          _iterator3.e(err);\n        } finally {\n          _iterator3.f();\n        }\n\n        if (this._data.size === 0) {\n          this._enterIdleMode();\n        }\n      } else {\n        var _iterator4 = _createForOfIteratorHelper(this._data),\n            _step4;\n\n        try {\n          for (_iterator4.s(); !(_step4 = _iterator4.n()).done;) {\n            var _step4$value = _slicedToArray(_step4.value, 2),\n                _key = _step4$value[0],\n                _data = _step4$value[1];\n\n            var _iterator5 = _createForOfIteratorHelper(what),\n                _step5;\n\n            try {\n              for (_iterator5.s(); !(_step5 = _iterator5.n()).done;) {\n                var item = _step5.value;\n\n                if (_key.startsWith(item)) {\n                  this._data[\"delete\"](_key);\n\n                  _data.level[\"delete\"](_key);\n\n                  break;\n                }\n              }\n            } catch (err) {\n              _iterator5.e(err);\n            } finally {\n              _iterator5.f();\n            }\n          }\n        } catch (err) {\n          _iterator4.e(err);\n        } finally {\n          _iterator4.f();\n        }\n\n        if (this._data.size === 0) {\n          this._enterIdleMode();\n        }\n      }\n    }\n  }, {\n    key: \"purgeParent\",\n    value: function purgeParent(what) {\n      if (!what) {\n        this.purge();\n      } else if (typeof what === \"string\") {\n        this.purge(dirname(what));\n      } else {\n        var set = new Set();\n\n        var _iterator6 = _createForOfIteratorHelper(what),\n            _step6;\n\n        try {\n          for (_iterator6.s(); !(_step6 = _iterator6.n()).done;) {\n            var item = _step6.value;\n            set.add(dirname(item));\n          }\n        } catch (err) {\n          _iterator6.e(err);\n        } finally {\n          _iterator6.f();\n        }\n\n        this.purge(set);\n      }\n    }\n  }, {\n    key: \"_storeResult\",\n    value: function _storeResult(path, err, result) {\n      if (this._data.has(path)) return;\n      var level = this._levels[this._currentLevel];\n\n      this._data.set(path, {\n        err: err,\n        result: result,\n        level: level\n      });\n\n      level.add(path);\n    }\n  }, {\n    key: \"_decayLevel\",\n    value: function _decayLevel() {\n      var nextLevel = (this._currentLevel + 1) % this._levels.length;\n      var decay = this._levels[nextLevel];\n      this._currentLevel = nextLevel;\n\n      var _iterator7 = _createForOfIteratorHelper(decay),\n          _step7;\n\n      try {\n        for (_iterator7.s(); !(_step7 = _iterator7.n()).done;) {\n          var item = _step7.value;\n\n          this._data[\"delete\"](item);\n        }\n      } catch (err) {\n        _iterator7.e(err);\n      } finally {\n        _iterator7.f();\n      }\n\n      decay.clear();\n\n      if (this._data.size === 0) {\n        this._enterIdleMode();\n      } else {\n        // @ts-ignore _nextDecay is always a number in sync mode\n        this._nextDecay += this._tickInterval;\n      }\n    }\n  }, {\n    key: \"_runDecays\",\n    value: function _runDecays() {\n      while (\n      /** @type {number} */\n      this._nextDecay <= Date.now() && this._mode !== STORAGE_MODE_IDLE) {\n        this._decayLevel();\n      }\n    }\n  }, {\n    key: \"_enterAsyncMode\",\n    value: function _enterAsyncMode() {\n      var _this3 = this;\n\n      var timeout = 0;\n\n      switch (this._mode) {\n        case STORAGE_MODE_ASYNC:\n          return;\n\n        case STORAGE_MODE_IDLE:\n          this._nextDecay = Date.now() + this._tickInterval;\n          timeout = this._tickInterval;\n          break;\n\n        case STORAGE_MODE_SYNC:\n          this._runDecays(); // @ts-ignore _runDecays may change the mode\n\n\n          if (this._mode === STORAGE_MODE_IDLE) return;\n          timeout = Math.max(0,\n          /** @type {number} */\n          this._nextDecay - Date.now());\n          break;\n      }\n\n      this._mode = STORAGE_MODE_ASYNC;\n      var ref = setTimeout(function () {\n        _this3._mode = STORAGE_MODE_SYNC;\n\n        _this3._runDecays();\n      }, timeout);\n      if (ref.unref) ref.unref();\n      this._timeout = ref;\n    }\n  }, {\n    key: \"_enterSyncModeWhenIdle\",\n    value: function _enterSyncModeWhenIdle() {\n      if (this._mode === STORAGE_MODE_IDLE) {\n        this._mode = STORAGE_MODE_SYNC;\n        this._nextDecay = Date.now() + this._tickInterval;\n      }\n    }\n  }, {\n    key: \"_enterIdleMode\",\n    value: function _enterIdleMode() {\n      this._mode = STORAGE_MODE_IDLE;\n      this._nextDecay = undefined;\n      if (this._timeout) clearTimeout(this._timeout);\n    }\n  }]);\n\n  return CacheBackend;\n}();\n\nvar createBackend = function createBackend(duration, provider, syncProvider, providerContext) {\n  if (duration > 0) {\n    return new CacheBackend(duration, provider, syncProvider, providerContext);\n  }\n\n  return new OperationMergerBackend(provider, syncProvider, providerContext);\n};\n\nmodule.exports = /*#__PURE__*/function () {\n  function CachedInputFileSystem(fileSystem, duration) {\n    var _this4 = this;\n\n    _classCallCheck(this, CachedInputFileSystem);\n\n    this.fileSystem = fileSystem;\n    this._lstatBackend = createBackend(duration, this.fileSystem.lstat, this.fileSystem.lstatSync, this.fileSystem);\n    var lstat = this._lstatBackend.provide;\n    this.lstat =\n    /** @type {FileSystem[\"lstat\"]} */\n    lstat;\n    var lstatSync = this._lstatBackend.provideSync;\n    this.lstatSync =\n    /** @type {SyncFileSystem[\"lstatSync\"]} */\n    lstatSync;\n    this._statBackend = createBackend(duration, this.fileSystem.stat, this.fileSystem.statSync, this.fileSystem);\n    var stat = this._statBackend.provide;\n    this.stat =\n    /** @type {FileSystem[\"stat\"]} */\n    stat;\n    var statSync = this._statBackend.provideSync;\n    this.statSync =\n    /** @type {SyncFileSystem[\"statSync\"]} */\n    statSync;\n    this._readdirBackend = createBackend(duration, this.fileSystem.readdir, this.fileSystem.readdirSync, this.fileSystem);\n    var readdir = this._readdirBackend.provide;\n    this.readdir =\n    /** @type {FileSystem[\"readdir\"]} */\n    readdir;\n    var readdirSync = this._readdirBackend.provideSync;\n    this.readdirSync =\n    /** @type {SyncFileSystem[\"readdirSync\"]} */\n    readdirSync;\n    this._readFileBackend = createBackend(duration, this.fileSystem.readFile, this.fileSystem.readFileSync, this.fileSystem);\n    var readFile = this._readFileBackend.provide;\n    this.readFile =\n    /** @type {FileSystem[\"readFile\"]} */\n    readFile;\n    var readFileSync = this._readFileBackend.provideSync;\n    this.readFileSync =\n    /** @type {SyncFileSystem[\"readFileSync\"]} */\n    readFileSync;\n    this._readJsonBackend = createBackend(duration, this.fileSystem.readJson || this.readFile && function (path, callback) {\n      // @ts-ignore\n      _this4.readFile(path, function (err, buffer) {\n        if (err) return callback(err);\n        if (!buffer || buffer.length === 0) return callback(new Error(\"No file content\"));\n        var data;\n\n        try {\n          data = JSON.parse(buffer.toString(\"utf-8\"));\n        } catch (e) {\n          return callback(e);\n        }\n\n        callback(null, data);\n      });\n    }, this.fileSystem.readJsonSync || this.readFileSync && function (path) {\n      var buffer = _this4.readFileSync(path);\n\n      var data = JSON.parse(buffer.toString(\"utf-8\"));\n      return data;\n    }, this.fileSystem);\n    var readJson = this._readJsonBackend.provide;\n    this.readJson =\n    /** @type {FileSystem[\"readJson\"]} */\n    readJson;\n    var readJsonSync = this._readJsonBackend.provideSync;\n    this.readJsonSync =\n    /** @type {SyncFileSystem[\"readJsonSync\"]} */\n    readJsonSync;\n    this._readlinkBackend = createBackend(duration, this.fileSystem.readlink, this.fileSystem.readlinkSync, this.fileSystem);\n    var readlink = this._readlinkBackend.provide;\n    this.readlink =\n    /** @type {FileSystem[\"readlink\"]} */\n    readlink;\n    var readlinkSync = this._readlinkBackend.provideSync;\n    this.readlinkSync =\n    /** @type {SyncFileSystem[\"readlinkSync\"]} */\n    readlinkSync;\n  }\n\n  _createClass(CachedInputFileSystem, [{\n    key: \"purge\",\n    value: function purge(what) {\n      this._statBackend.purge(what);\n\n      this._lstatBackend.purge(what);\n\n      this._readdirBackend.purgeParent(what);\n\n      this._readFileBackend.purge(what);\n\n      this._readlinkBackend.purge(what);\n\n      this._readJsonBackend.purge(what);\n    }\n  }]);\n\n  return CachedInputFileSystem;\n}();","map":{"version":3,"names":["nextTick","require","dirname","path","idx","length","c","charCodeAt","slice","runCallbacks","callbacks","err","result","error","callback","e","OperationMergerBackend","provider","syncProvider","providerContext","_provider","_syncProvider","_providerContext","_activeAsyncOperations","Map","provide","options","undefined","call","TypeError","get","push","set","provideSync","STORAGE_MODE_IDLE","STORAGE_MODE_SYNC","STORAGE_MODE_ASYNC","CacheBackend","duration","_duration","_data","_levels","i","Set","_currentLevel","_tickInterval","Math","floor","_mode","_timeout","_nextDecay","bind","_enterAsyncMode","cacheEntry","_storeResult","_runDecays","_enterSyncModeWhenIdle","what","clear","level","_enterIdleMode","key","data","startsWith","size","item","purge","add","has","nextLevel","decay","Date","now","_decayLevel","timeout","max","ref","setTimeout","unref","clearTimeout","createBackend","module","exports","fileSystem","_lstatBackend","lstat","lstatSync","_statBackend","stat","statSync","_readdirBackend","readdir","readdirSync","_readFileBackend","readFile","readFileSync","_readJsonBackend","readJson","buffer","Error","JSON","parse","toString","readJsonSync","_readlinkBackend","readlink","readlinkSync","purgeParent"],"sources":["D:/Work/Project/LMS/lms/node_modules/enhanced-resolve/lib/CachedInputFileSystem.js"],"sourcesContent":["/*\n\tMIT License http://www.opensource.org/licenses/mit-license.php\n\tAuthor Tobias Koppers @sokra\n*/\n\n\"use strict\";\n\nconst nextTick = require(\"process\").nextTick;\n\n/** @typedef {import(\"./Resolver\").FileSystem} FileSystem */\n/** @typedef {import(\"./Resolver\").SyncFileSystem} SyncFileSystem */\n\nconst dirname = path => {\n\tlet idx = path.length - 1;\n\twhile (idx >= 0) {\n\t\tconst c = path.charCodeAt(idx);\n\t\t// slash or backslash\n\t\tif (c === 47 || c === 92) break;\n\t\tidx--;\n\t}\n\tif (idx < 0) return \"\";\n\treturn path.slice(0, idx);\n};\n\nconst runCallbacks = (callbacks, err, result) => {\n\tif (callbacks.length === 1) {\n\t\tcallbacks[0](err, result);\n\t\tcallbacks.length = 0;\n\t\treturn;\n\t}\n\tlet error;\n\tfor (const callback of callbacks) {\n\t\ttry {\n\t\t\tcallback(err, result);\n\t\t} catch (e) {\n\t\t\tif (!error) error = e;\n\t\t}\n\t}\n\tcallbacks.length = 0;\n\tif (error) throw error;\n};\n\nclass OperationMergerBackend {\n\t/**\n\t * @param {any} provider async method\n\t * @param {any} syncProvider sync method\n\t * @param {any} providerContext call context for the provider methods\n\t */\n\tconstructor(provider, syncProvider, providerContext) {\n\t\tthis._provider = provider;\n\t\tthis._syncProvider = syncProvider;\n\t\tthis._providerContext = providerContext;\n\t\tthis._activeAsyncOperations = new Map();\n\n\t\tthis.provide = this._provider\n\t\t\t? (path, options, callback) => {\n\t\t\t\t\tif (typeof options === \"function\") {\n\t\t\t\t\t\tcallback = options;\n\t\t\t\t\t\toptions = undefined;\n\t\t\t\t\t}\n\t\t\t\t\tif (options) {\n\t\t\t\t\t\treturn this._provider.call(\n\t\t\t\t\t\t\tthis._providerContext,\n\t\t\t\t\t\t\tpath,\n\t\t\t\t\t\t\toptions,\n\t\t\t\t\t\t\tcallback\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t\tif (typeof path !== \"string\") {\n\t\t\t\t\t\tcallback(new TypeError(\"path must be a string\"));\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tlet callbacks = this._activeAsyncOperations.get(path);\n\t\t\t\t\tif (callbacks) {\n\t\t\t\t\t\tcallbacks.push(callback);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tthis._activeAsyncOperations.set(path, (callbacks = [callback]));\n\t\t\t\t\tprovider(path, (err, result) => {\n\t\t\t\t\t\tthis._activeAsyncOperations.delete(path);\n\t\t\t\t\t\trunCallbacks(callbacks, err, result);\n\t\t\t\t\t});\n\t\t\t  }\n\t\t\t: null;\n\t\tthis.provideSync = this._syncProvider\n\t\t\t? (path, options) => {\n\t\t\t\t\treturn this._syncProvider.call(this._providerContext, path, options);\n\t\t\t  }\n\t\t\t: null;\n\t}\n\n\tpurge() {}\n\tpurgeParent() {}\n}\n\n/*\n\nIDLE:\n\tinsert data: goto SYNC\n\nSYNC:\n\tbefore provide: run ticks\n\tevent loop tick: goto ASYNC_ACTIVE\n\nASYNC:\n\ttimeout: run tick, goto ASYNC_PASSIVE\n\nASYNC_PASSIVE:\n\tbefore provide: run ticks\n\nIDLE --[insert data]--> SYNC --[event loop tick]--> ASYNC_ACTIVE --[interval tick]-> ASYNC_PASSIVE\n                                                          ^                             |\n                                                          +---------[insert data]-------+\n*/\n\nconst STORAGE_MODE_IDLE = 0;\nconst STORAGE_MODE_SYNC = 1;\nconst STORAGE_MODE_ASYNC = 2;\n\nclass CacheBackend {\n\t/**\n\t * @param {number} duration max cache duration of items\n\t * @param {any} provider async method\n\t * @param {any} syncProvider sync method\n\t * @param {any} providerContext call context for the provider methods\n\t */\n\tconstructor(duration, provider, syncProvider, providerContext) {\n\t\tthis._duration = duration;\n\t\tthis._provider = provider;\n\t\tthis._syncProvider = syncProvider;\n\t\tthis._providerContext = providerContext;\n\t\t/** @type {Map<string, (function(Error, any): void)[]>} */\n\t\tthis._activeAsyncOperations = new Map();\n\t\t/** @type {Map<string, { err: Error, result: any, level: Set<string> }>} */\n\t\tthis._data = new Map();\n\t\t/** @type {Set<string>[]} */\n\t\tthis._levels = [];\n\t\tfor (let i = 0; i < 10; i++) this._levels.push(new Set());\n\t\tfor (let i = 5000; i < duration; i += 500) this._levels.push(new Set());\n\t\tthis._currentLevel = 0;\n\t\tthis._tickInterval = Math.floor(duration / this._levels.length);\n\t\t/** @type {STORAGE_MODE_IDLE | STORAGE_MODE_SYNC | STORAGE_MODE_ASYNC} */\n\t\tthis._mode = STORAGE_MODE_IDLE;\n\n\t\t/** @type {NodeJS.Timeout | undefined} */\n\t\tthis._timeout = undefined;\n\t\t/** @type {number | undefined} */\n\t\tthis._nextDecay = undefined;\n\n\t\tthis.provide = provider ? this.provide.bind(this) : null;\n\t\tthis.provideSync = syncProvider ? this.provideSync.bind(this) : null;\n\t}\n\n\tprovide(path, options, callback) {\n\t\tif (typeof options === \"function\") {\n\t\t\tcallback = options;\n\t\t\toptions = undefined;\n\t\t}\n\t\tif (typeof path !== \"string\") {\n\t\t\tcallback(new TypeError(\"path must be a string\"));\n\t\t\treturn;\n\t\t}\n\t\tif (options) {\n\t\t\treturn this._provider.call(\n\t\t\t\tthis._providerContext,\n\t\t\t\tpath,\n\t\t\t\toptions,\n\t\t\t\tcallback\n\t\t\t);\n\t\t}\n\n\t\t// When in sync mode we can move to async mode\n\t\tif (this._mode === STORAGE_MODE_SYNC) {\n\t\t\tthis._enterAsyncMode();\n\t\t}\n\n\t\t// Check in cache\n\t\tlet cacheEntry = this._data.get(path);\n\t\tif (cacheEntry !== undefined) {\n\t\t\tif (cacheEntry.err) return nextTick(callback, cacheEntry.err);\n\t\t\treturn nextTick(callback, null, cacheEntry.result);\n\t\t}\n\n\t\t// Check if there is already the same operation running\n\t\tlet callbacks = this._activeAsyncOperations.get(path);\n\t\tif (callbacks !== undefined) {\n\t\t\tcallbacks.push(callback);\n\t\t\treturn;\n\t\t}\n\t\tthis._activeAsyncOperations.set(path, (callbacks = [callback]));\n\n\t\t// Run the operation\n\t\tthis._provider.call(this._providerContext, path, (err, result) => {\n\t\t\tthis._activeAsyncOperations.delete(path);\n\t\t\tthis._storeResult(path, err, result);\n\n\t\t\t// Enter async mode if not yet done\n\t\t\tthis._enterAsyncMode();\n\n\t\t\trunCallbacks(callbacks, err, result);\n\t\t});\n\t}\n\n\tprovideSync(path, options) {\n\t\tif (typeof path !== \"string\") {\n\t\t\tthrow new TypeError(\"path must be a string\");\n\t\t}\n\t\tif (options) {\n\t\t\treturn this._syncProvider.call(this._providerContext, path, options);\n\t\t}\n\n\t\t// In sync mode we may have to decay some cache items\n\t\tif (this._mode === STORAGE_MODE_SYNC) {\n\t\t\tthis._runDecays();\n\t\t}\n\n\t\t// Check in cache\n\t\tlet cacheEntry = this._data.get(path);\n\t\tif (cacheEntry !== undefined) {\n\t\t\tif (cacheEntry.err) throw cacheEntry.err;\n\t\t\treturn cacheEntry.result;\n\t\t}\n\n\t\t// Get all active async operations\n\t\t// This sync operation will also complete them\n\t\tconst callbacks = this._activeAsyncOperations.get(path);\n\t\tthis._activeAsyncOperations.delete(path);\n\n\t\t// Run the operation\n\t\t// When in idle mode, we will enter sync mode\n\t\tlet result;\n\t\ttry {\n\t\t\tresult = this._syncProvider.call(this._providerContext, path);\n\t\t} catch (err) {\n\t\t\tthis._storeResult(path, err, undefined);\n\t\t\tthis._enterSyncModeWhenIdle();\n\t\t\tif (callbacks) runCallbacks(callbacks, err, undefined);\n\t\t\tthrow err;\n\t\t}\n\t\tthis._storeResult(path, undefined, result);\n\t\tthis._enterSyncModeWhenIdle();\n\t\tif (callbacks) runCallbacks(callbacks, undefined, result);\n\t\treturn result;\n\t}\n\n\tpurge(what) {\n\t\tif (!what) {\n\t\t\tif (this._mode !== STORAGE_MODE_IDLE) {\n\t\t\t\tthis._data.clear();\n\t\t\t\tfor (const level of this._levels) {\n\t\t\t\t\tlevel.clear();\n\t\t\t\t}\n\t\t\t\tthis._enterIdleMode();\n\t\t\t}\n\t\t} else if (typeof what === \"string\") {\n\t\t\tfor (let [key, data] of this._data) {\n\t\t\t\tif (key.startsWith(what)) {\n\t\t\t\t\tthis._data.delete(key);\n\t\t\t\t\tdata.level.delete(key);\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (this._data.size === 0) {\n\t\t\t\tthis._enterIdleMode();\n\t\t\t}\n\t\t} else {\n\t\t\tfor (let [key, data] of this._data) {\n\t\t\t\tfor (const item of what) {\n\t\t\t\t\tif (key.startsWith(item)) {\n\t\t\t\t\t\tthis._data.delete(key);\n\t\t\t\t\t\tdata.level.delete(key);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (this._data.size === 0) {\n\t\t\t\tthis._enterIdleMode();\n\t\t\t}\n\t\t}\n\t}\n\n\tpurgeParent(what) {\n\t\tif (!what) {\n\t\t\tthis.purge();\n\t\t} else if (typeof what === \"string\") {\n\t\t\tthis.purge(dirname(what));\n\t\t} else {\n\t\t\tconst set = new Set();\n\t\t\tfor (const item of what) {\n\t\t\t\tset.add(dirname(item));\n\t\t\t}\n\t\t\tthis.purge(set);\n\t\t}\n\t}\n\n\t_storeResult(path, err, result) {\n\t\tif (this._data.has(path)) return;\n\t\tconst level = this._levels[this._currentLevel];\n\t\tthis._data.set(path, { err, result, level });\n\t\tlevel.add(path);\n\t}\n\n\t_decayLevel() {\n\t\tconst nextLevel = (this._currentLevel + 1) % this._levels.length;\n\t\tconst decay = this._levels[nextLevel];\n\t\tthis._currentLevel = nextLevel;\n\t\tfor (let item of decay) {\n\t\t\tthis._data.delete(item);\n\t\t}\n\t\tdecay.clear();\n\t\tif (this._data.size === 0) {\n\t\t\tthis._enterIdleMode();\n\t\t} else {\n\t\t\t// @ts-ignore _nextDecay is always a number in sync mode\n\t\t\tthis._nextDecay += this._tickInterval;\n\t\t}\n\t}\n\n\t_runDecays() {\n\t\twhile (\n\t\t\t/** @type {number} */ (this._nextDecay) <= Date.now() &&\n\t\t\tthis._mode !== STORAGE_MODE_IDLE\n\t\t) {\n\t\t\tthis._decayLevel();\n\t\t}\n\t}\n\n\t_enterAsyncMode() {\n\t\tlet timeout = 0;\n\t\tswitch (this._mode) {\n\t\t\tcase STORAGE_MODE_ASYNC:\n\t\t\t\treturn;\n\t\t\tcase STORAGE_MODE_IDLE:\n\t\t\t\tthis._nextDecay = Date.now() + this._tickInterval;\n\t\t\t\ttimeout = this._tickInterval;\n\t\t\t\tbreak;\n\t\t\tcase STORAGE_MODE_SYNC:\n\t\t\t\tthis._runDecays();\n\t\t\t\t// @ts-ignore _runDecays may change the mode\n\t\t\t\tif (this._mode === STORAGE_MODE_IDLE) return;\n\t\t\t\ttimeout = Math.max(\n\t\t\t\t\t0,\n\t\t\t\t\t/** @type {number} */ (this._nextDecay) - Date.now()\n\t\t\t\t);\n\t\t\t\tbreak;\n\t\t}\n\t\tthis._mode = STORAGE_MODE_ASYNC;\n\t\tconst ref = setTimeout(() => {\n\t\t\tthis._mode = STORAGE_MODE_SYNC;\n\t\t\tthis._runDecays();\n\t\t}, timeout);\n\t\tif (ref.unref) ref.unref();\n\t\tthis._timeout = ref;\n\t}\n\n\t_enterSyncModeWhenIdle() {\n\t\tif (this._mode === STORAGE_MODE_IDLE) {\n\t\t\tthis._mode = STORAGE_MODE_SYNC;\n\t\t\tthis._nextDecay = Date.now() + this._tickInterval;\n\t\t}\n\t}\n\n\t_enterIdleMode() {\n\t\tthis._mode = STORAGE_MODE_IDLE;\n\t\tthis._nextDecay = undefined;\n\t\tif (this._timeout) clearTimeout(this._timeout);\n\t}\n}\n\nconst createBackend = (duration, provider, syncProvider, providerContext) => {\n\tif (duration > 0) {\n\t\treturn new CacheBackend(duration, provider, syncProvider, providerContext);\n\t}\n\treturn new OperationMergerBackend(provider, syncProvider, providerContext);\n};\n\nmodule.exports = class CachedInputFileSystem {\n\tconstructor(fileSystem, duration) {\n\t\tthis.fileSystem = fileSystem;\n\n\t\tthis._lstatBackend = createBackend(\n\t\t\tduration,\n\t\t\tthis.fileSystem.lstat,\n\t\t\tthis.fileSystem.lstatSync,\n\t\t\tthis.fileSystem\n\t\t);\n\t\tconst lstat = this._lstatBackend.provide;\n\t\tthis.lstat = /** @type {FileSystem[\"lstat\"]} */ (lstat);\n\t\tconst lstatSync = this._lstatBackend.provideSync;\n\t\tthis.lstatSync = /** @type {SyncFileSystem[\"lstatSync\"]} */ (lstatSync);\n\n\t\tthis._statBackend = createBackend(\n\t\t\tduration,\n\t\t\tthis.fileSystem.stat,\n\t\t\tthis.fileSystem.statSync,\n\t\t\tthis.fileSystem\n\t\t);\n\t\tconst stat = this._statBackend.provide;\n\t\tthis.stat = /** @type {FileSystem[\"stat\"]} */ (stat);\n\t\tconst statSync = this._statBackend.provideSync;\n\t\tthis.statSync = /** @type {SyncFileSystem[\"statSync\"]} */ (statSync);\n\n\t\tthis._readdirBackend = createBackend(\n\t\t\tduration,\n\t\t\tthis.fileSystem.readdir,\n\t\t\tthis.fileSystem.readdirSync,\n\t\t\tthis.fileSystem\n\t\t);\n\t\tconst readdir = this._readdirBackend.provide;\n\t\tthis.readdir = /** @type {FileSystem[\"readdir\"]} */ (readdir);\n\t\tconst readdirSync = this._readdirBackend.provideSync;\n\t\tthis.readdirSync = /** @type {SyncFileSystem[\"readdirSync\"]} */ (readdirSync);\n\n\t\tthis._readFileBackend = createBackend(\n\t\t\tduration,\n\t\t\tthis.fileSystem.readFile,\n\t\t\tthis.fileSystem.readFileSync,\n\t\t\tthis.fileSystem\n\t\t);\n\t\tconst readFile = this._readFileBackend.provide;\n\t\tthis.readFile = /** @type {FileSystem[\"readFile\"]} */ (readFile);\n\t\tconst readFileSync = this._readFileBackend.provideSync;\n\t\tthis.readFileSync = /** @type {SyncFileSystem[\"readFileSync\"]} */ (readFileSync);\n\n\t\tthis._readJsonBackend = createBackend(\n\t\t\tduration,\n\t\t\tthis.fileSystem.readJson ||\n\t\t\t\t(this.readFile &&\n\t\t\t\t\t((path, callback) => {\n\t\t\t\t\t\t// @ts-ignore\n\t\t\t\t\t\tthis.readFile(path, (err, buffer) => {\n\t\t\t\t\t\t\tif (err) return callback(err);\n\t\t\t\t\t\t\tif (!buffer || buffer.length === 0)\n\t\t\t\t\t\t\t\treturn callback(new Error(\"No file content\"));\n\t\t\t\t\t\t\tlet data;\n\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\tdata = JSON.parse(buffer.toString(\"utf-8\"));\n\t\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\t\treturn callback(e);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tcallback(null, data);\n\t\t\t\t\t\t});\n\t\t\t\t\t})),\n\t\t\tthis.fileSystem.readJsonSync ||\n\t\t\t\t(this.readFileSync &&\n\t\t\t\t\t(path => {\n\t\t\t\t\t\tconst buffer = this.readFileSync(path);\n\t\t\t\t\t\tconst data = JSON.parse(buffer.toString(\"utf-8\"));\n\t\t\t\t\t\treturn data;\n\t\t\t\t\t})),\n\t\t\tthis.fileSystem\n\t\t);\n\t\tconst readJson = this._readJsonBackend.provide;\n\t\tthis.readJson = /** @type {FileSystem[\"readJson\"]} */ (readJson);\n\t\tconst readJsonSync = this._readJsonBackend.provideSync;\n\t\tthis.readJsonSync = /** @type {SyncFileSystem[\"readJsonSync\"]} */ (readJsonSync);\n\n\t\tthis._readlinkBackend = createBackend(\n\t\t\tduration,\n\t\t\tthis.fileSystem.readlink,\n\t\t\tthis.fileSystem.readlinkSync,\n\t\t\tthis.fileSystem\n\t\t);\n\t\tconst readlink = this._readlinkBackend.provide;\n\t\tthis.readlink = /** @type {FileSystem[\"readlink\"]} */ (readlink);\n\t\tconst readlinkSync = this._readlinkBackend.provideSync;\n\t\tthis.readlinkSync = /** @type {SyncFileSystem[\"readlinkSync\"]} */ (readlinkSync);\n\t}\n\n\tpurge(what) {\n\t\tthis._statBackend.purge(what);\n\t\tthis._lstatBackend.purge(what);\n\t\tthis._readdirBackend.purgeParent(what);\n\t\tthis._readFileBackend.purge(what);\n\t\tthis._readlinkBackend.purge(what);\n\t\tthis._readJsonBackend.purge(what);\n\t}\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}