{"ast":null,"code":"import _asyncToGenerator from \"D:/Work/Project/LMS/lms/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport \"core-js/modules/es.number.constructor.js\";\nimport \"regenerator-runtime/runtime.js\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport Footer from \"./Footer.vue\";\nimport Header from \"./Header.vue\";\nexport default {\n  components: {\n    Footer: Footer,\n    Header: Header\n  },\n  data: function data() {\n    return {\n      // 查询建议\n      suggestionArray: [],\n      searchText: \"\",\n      // 查询排行榜表单数据\n      books: []\n    };\n  },\n  created: function created() {\n    var _this = this;\n\n    return _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee() {\n      var _yield$_this$$http$ge, res;\n\n      return regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return _this.$http.get(\"/book\");\n\n            case 2:\n              _yield$_this$$http$ge = _context.sent;\n              res = _yield$_this$$http$ge.data;\n              _this.books = res.data;\n              _this.$store.state.userinfo = res.data;\n\n            case 6:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }))();\n  },\n  methods: {\n    // 选择搜索建议\n    handleSelect: function handleSelect(item) {\n      if (this.select == \"\") {\n        this.select = \"book_name\";\n      }\n\n      this.searchText = item;\n    },\n    // 获取搜索建议\n    querySearch: function querySearch(queryString, cb) {\n      var _this2 = this;\n\n      return _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee2() {\n        var _yield$_this2$$http, res;\n\n        return regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                _context2.next = 2;\n                return _this2.$http({\n                  method: \"get\",\n                  url: \"/book/suggestion?queryKey=\" + (_this2.select != \"\" ? _this2.select : \"book_name\") + \"&queryVal=\" + queryString\n                });\n\n              case 2:\n                _yield$_this2$$http = _context2.sent;\n                res = _yield$_this2$$http.data;\n                console.log(res.data); // 调用callback返回建议的数据\n\n                cb(res.data);\n\n              case 6:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2);\n      }))();\n    },\n    // 收藏书本按钮事件\n    takeBookItem: function takeBookItem(index, row) {\n      var _this3 = this;\n\n      return _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee3() {\n        var _yield$_this3$$http, res;\n\n        return regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                if (!(_this3.$store.getters.getToken === null)) {\n                  _context3.next = 2;\n                  break;\n                }\n\n                return _context3.abrupt(\"return\", _this3.$message.error(\"请先登录！\"));\n\n              case 2:\n                _context3.next = 4;\n                return _this3.$http({\n                  method: \"post\",\n                  url: \"/collection?access_token=\" + _this3.$store.getters.getToken,\n                  data: {\n                    user_id: Number(_this3.$store.state.userinfo.user_id),\n                    book_id: row.book_id\n                  }\n                });\n\n              case 4:\n                _yield$_this3$$http = _context3.sent;\n                res = _yield$_this3$$http.data;\n\n                if (res.code === 200) {\n                  _this3.$message.success(\"收藏成功\");\n                } else {\n                  _this3.$message(\"已收藏\");\n                }\n\n              case 7:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3);\n      }))();\n    },\n    // 寻找书本\n    searchBookItem: function searchBookItem() {\n      var _this4 = this;\n\n      return _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee4() {\n        var _yield$_this4$$http, res;\n\n        return regeneratorRuntime.wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                if (!(_this4.select === \"\")) {\n                  _context4.next = 4;\n                  break;\n                }\n\n                return _context4.abrupt(\"return\", _this4.$message.error(\"请选择搜索类别\"));\n\n              case 4:\n                if (!(_this4.searchText === \"\")) {\n                  _context4.next = 6;\n                  break;\n                }\n\n                return _context4.abrupt(\"return\", _this4.$message.error(\"请输入搜索内容\"));\n\n              case 6:\n                _context4.next = 8;\n                return _this4.$http({\n                  method: \"get\",\n                  url: \"/book\" + \"?\" + _this4.select + \"=\" + _this4.searchText\n                });\n\n              case 8:\n                _yield$_this4$$http = _context4.sent;\n                res = _yield$_this4$$http.data;\n\n                if (res.code === 200) {\n                  _this4.tableData = res.data;\n\n                  _this4.$message.success(\"搜索成功\");\n                } else {\n                  _this4.$message.error(\"搜索失败\");\n                }\n\n              case 11:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, _callee4);\n      }))();\n    }\n  }\n};","map":{"version":3,"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAwDA;AACA;AACA;EACAA;IAAAC;IAAAC;EAAA,CADA;EAEAC,IAFA,kBAEA;IACA;MACA;MACAC,mBAFA;MAGAC,cAHA;MAIA;MACAC;IALA;EAOA,CAVA;EAWAC,OAXA,qBAWA;IAAA;;IAAA;MAAA;;MAAA;QAAA;UAAA;YAAA;cAAA;cAAA,OAEA,wBAFA;;YAAA;cAAA;cAEAC,GAFA,yBAEAL,IAFA;cAGA;cACA;;YAJA;YAAA;cAAA;UAAA;QAAA;MAAA;IAAA;EAKA,CAhBA;EAiBAM;IACA;IACAC,YAFA,wBAEAC,IAFA,EAEA;MACA;QACA;MACA;;MACA;IACA,CAPA;IAQA;IACAC,WATA,uBASAC,WATA,EASAC,EATA,EASA;MAAA;;MAAA;QAAA;;QAAA;UAAA;YAAA;cAAA;gBAAA;gBAAA,OAGA;kBACAC,aADA;kBAEAC,KACA,gCACA,iDADA,IAEA,YAFA,GAGAH;gBANA,EAHA;;cAAA;gBAAA;gBAGAL,GAHA,uBAGAL,IAHA;gBAWAc,sBAXA,CAYA;;gBACAH;;cAbA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IAcA,CAvBA;IAyBA;IACAI,YA1BA,wBA0BAC,KA1BA,EA0BAC,GA1BA,EA0BA;MAAA;;MAAA;QAAA;;QAAA;UAAA;YAAA;cAAA;gBAAA,MAEA,uCAFA;kBAAA;kBAAA;gBAAA;;gBAAA,kCAGA,8BAHA;;cAAA;gBAAA;gBAAA,OAMA;kBACAL,cADA;kBAEAC,iEAFA;kBAGAb;oBACAkB,qDADA;oBAEAC;kBAFA;gBAHA,EANA;;cAAA;gBAAA;gBAMAd,GANA,uBAMAL,IANA;;gBAcA;kBACA;gBACA,CAFA,MAEA;kBACA;gBACA;;cAlBA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IAmBA,CA7CA;IA8CA;IACAoB,cA/CA,4BA+CA;MAAA;;MAAA;QAAA;;QAAA;UAAA;YAAA;cAAA;gBAAA,MACA,oBADA;kBAAA;kBAAA;gBAAA;;gBAAA,kCAEA,gCAFA;;cAAA;gBAAA,MAGA,wBAHA;kBAAA;kBAAA;gBAAA;;gBAAA,kCAIA,gCAJA;;cAAA;gBAAA;gBAAA,OAMA;kBACAR,aADA;kBAEAC;gBAFA,EANA;;cAAA;gBAAA;gBAMAR,GANA,uBAMAL,IANA;;gBAUA;kBACA;;kBACA;gBACA,CAHA,MAGA;kBACA;gBACA;;cAfA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IAgBA;EA/DA;AAjBA","names":["components","Footer","Header","data","suggestionArray","searchText","books","created","res","methods","handleSelect","item","querySearch","queryString","cb","method","url","console","takeBookItem","index","row","user_id","book_id","searchBookItem"],"sourceRoot":"src/components","sources":["Home.vue"],"sourcesContent":["<template>\r\n  <div class=\"page-body\">\r\n    <!-- 头部 -->\r\n    <Header></Header>\r\n    <!-- 书本显示主体 -->\r\n    <el-container class=\"main-container\">\r\n      <!-- logo -->\r\n      <el-header class=\"logo-container\" height=\"100px\">\r\n        <a href=\"javascript:;\"><img src=\"../../public/logo.png\" alt=\"\" /> </a>\r\n      </el-header>\r\n      <!-- 搜索框 -->\r\n      <el-autocomplete\r\n        placeholder=\"搜索书本类型，名称，出版社，描述\"\r\n        v-model=\"searchText\"\r\n        class=\"input-with-select\"\r\n        :fetch-suggestions=\"querySearch\"\r\n        :trigger-on-focus=\"false\"\r\n        @select=\"handleSelect\"\r\n      >\r\n        <template slot-scope=\"{ item }\">\r\n          {{ item }}\r\n        </template>\r\n        <el-button\r\n          type=\"primer\"\r\n          slot=\"append\"\r\n          icon=\"el-icon-search\"\r\n          @click=\"searchBookItem\"\r\n        ></el-button>\r\n      </el-autocomplete>\r\n      <!-- 显示书本部分 -->\r\n      <el-main>\r\n        <div class=\"divider\">\r\n          <h1>&nbsp;&nbsp;&nbsp;最受欢迎的</h1>\r\n          <el-divider></el-divider>\r\n        </div>\r\n        <!-- 信息部分 -->\r\n        <div style=\"height:1000px\">\r\n          <div class=\"book_item\" v-for=\"b in books\">\r\n            <a href=\"/home/book/\">\r\n              <img\r\n                :src=\"\r\n                  `http://localhost:8081/static/img/books/` +\r\n                  b.book_img_url.split('/').at(-1)\r\n                \"\r\n                alt=\"书本图片\"\r\n              />\r\n            </a>\r\n          </div>\r\n        </div>\r\n      </el-main>\r\n    </el-container>\r\n    <Footer></Footer>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport Footer from \"./Footer.vue\";\r\nimport Header from \"./Header.vue\";\r\nexport default {\r\n  components: { Footer, Header },\r\n  data() {\r\n    return {\r\n      // 查询建议\r\n      suggestionArray: [],\r\n      searchText: \"\",\r\n      // 查询排行榜表单数据\r\n      books: [],\r\n    };\r\n  },\r\n  async created() {\r\n    // 从后端api初始化tableData\r\n    const { data: res } = await this.$http.get(\"/book\");\r\n    this.books = res.data;\r\n    this.$store.state.userinfo = res.data;\r\n  },\r\n  methods: {\r\n    // 选择搜索建议\r\n    handleSelect(item) {\r\n      if (this.select == \"\") {\r\n        this.select = \"book_name\";\r\n      }\r\n      this.searchText = item;\r\n    },\r\n    // 获取搜索建议\r\n    async querySearch(queryString, cb) {\r\n      // console.log(str)\r\n      // 发送后台请求获取搜索建议\r\n      const { data: res } = await this.$http({\r\n        method: \"get\",\r\n        url:\r\n          \"/book/suggestion?queryKey=\" +\r\n          (this.select != \"\" ? this.select : \"book_name\") +\r\n          \"&queryVal=\" +\r\n          queryString,\r\n      });\r\n      console.log(res.data);\r\n      // 调用callback返回建议的数据\r\n      cb(res.data);\r\n    },\r\n\r\n    // 收藏书本按钮事件\r\n    async takeBookItem(index, row) {\r\n      // 检验用户登录\r\n      if (this.$store.getters.getToken === null) {\r\n        return this.$message.error(\"请先登录！\");\r\n      }\r\n      // 请后后台，收藏书籍\r\n      const { data: res } = await this.$http({\r\n        method: \"post\",\r\n        url: \"/collection?access_token=\" + this.$store.getters.getToken,\r\n        data: {\r\n          user_id: Number(this.$store.state.userinfo.user_id),\r\n          book_id: row.book_id,\r\n        },\r\n      });\r\n      if (res.code === 200) {\r\n        this.$message.success(\"收藏成功\");\r\n      } else {\r\n        this.$message(\"已收藏\");\r\n      }\r\n    },\r\n    // 寻找书本\r\n    async searchBookItem() {\r\n      if (this.select === \"\") {\r\n        return this.$message.error(\"请选择搜索类别\");\r\n      } else if (this.searchText === \"\") {\r\n        return this.$message.error(\"请输入搜索内容\");\r\n      }\r\n      const { data: res } = await this.$http({\r\n        method: \"get\",\r\n        url: \"/book\" + \"?\" + this.select + \"=\" + this.searchText,\r\n      });\r\n      if (res.code === 200) {\r\n        this.tableData = res.data;\r\n        this.$message.success(\"搜索成功\");\r\n      } else {\r\n        this.$message.error(\"搜索失败\");\r\n      }\r\n    },\r\n  },\r\n};\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n// 内容容器\r\n.main-container {\r\n  line-height: 30px;\r\n  width: 75%; \r\n  padding: 20px;\r\n  margin: 50px auto;\r\n  background-color: white;\r\n  box-shadow: 0 4px 14px 0 rgb(0 0 0 / 5%);\r\n  box-sizing: border-box;\r\n}\r\n\r\n// logo样式\r\n.logo-container {\r\n  text-align: center;\r\n  margin-bottom: 20px;\r\n  img {\r\n    width: 300px;\r\n    height: 100px;\r\n  }\r\n}\r\n\r\n// 书本样式\r\n.book_item {\r\n  display: inline-block;\r\n  width: 270px;\r\n  height: 400px;\r\n  padding:8px;\r\n  flex:1;\r\n  img {\r\n    height: 100%;\r\n    width: 100%;\r\n  }\r\n}\r\n\r\n// 移动端适配\r\n@media (max-width: 600px) {\r\n  .main-container {\r\n    margin: 30px auto;\r\n    width: 90%;\r\n    padding: 10px;\r\n  }\r\n  .logo-container {\r\n    margin-bottom: 0px;\r\n    img {\r\n      width: 200px;\r\n      height: 70px;\r\n    }\r\n  }\r\n  .divider {\r\n    h1 {\r\n      font-size: 20px;\r\n    }\r\n  }\r\n}\r\n\r\n// 设置分割线\r\n.divider {\r\n  margin-top: 25px;\r\n  color: #49afd0;\r\n  font-size: 16pt;\r\n  // 分割线容器\r\n  .el-divider {\r\n    background-color: #49afd0;\r\n  }\r\n}\r\n</style>\r\n"]},"metadata":{},"sourceType":"module"}