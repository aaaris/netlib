{"ast":null,"code":"import \"core-js/modules/es.array.for-each.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/web.dom-collections.for-each.js\";\nimport \"core-js/modules/es.string.iterator.js\";\nimport \"core-js/modules/web.dom-collections.iterator.js\";\nimport \"core-js/modules/es.array.splice.js\";\nimport Vue from \"vue\";\nimport Router from \"vue-router\";\nimport Login from \"./components/user/Login.vue\";\nimport Regist from \"./components/user/Regist.vue\";\nimport Home from \"./components/Home.vue\";\nimport Index from \"./components/index/Index.vue\";\nimport axios from \"axios\";\nimport store from \"./store/store\";\nVue.use(Router);\nvar routes = [{\n  path: \"/index\",\n  component: Index,\n  redirect: \"/index/profile\",\n  // 路由嵌套\n  children: []\n}, {\n  path: \"/\",\n  redirect: \"/home\"\n}, {\n  path: \"/login\",\n  component: Login\n}, {\n  path: \"/regist\",\n  component: Regist\n}, {\n  path: \"/home\",\n  component: Home\n}];\nvar router = new Router({\n  mode: \"history\",\n  base: process.env.BASE_URL,\n  routes: routes\n});\nvar oRoutes = router.options.routes; // 生成动态路由\n\nvar buildRouter = function buildRouter() {\n  var data = store.state.menu_data;\n  data.forEach(function (item) {\n    item.child.forEach(function (child) {\n      var new_router = {\n        path: child.path,\n        component: function component() {\n          return import(\"./components/index/Index.vue\");\n        }\n      };\n      router.options.routes[0].children.push(new_router);\n    });\n  });\n};\n\nrouter.beforeEach(function (to, from, next) {\n  // 判断路由是否已经加载过\n  // if (to != \"/index\") {\n  //   next();\n  // }\n  // console.log(to, from);\n  var isLoadRoute = store.state.isLoadRoute;\n\n  if (!isLoadRoute) {\n    // axios.get(\"/menuList\").then((res) => {\n    //   store.commit(\"setMeunData\", res.data, menu_data);\n    // });\n    var menu_data = [{\n      name: \"USER\",\n      icon: \"el-icon-user\",\n      child: [{\n        name: \"个人信息\",\n        icon: \"el-icon-document\",\n        path: \"/index/profile\",\n        componentPath: \"/index/user/Profile.vue\"\n      }, {\n        name: \"我的收藏\",\n        icon: \"el-icon-collection\",\n        path: \"/index/collection\",\n        componentPath: \"/index/user/Collection.vue\"\n      }, {\n        name: \"我的分享\",\n        icon: \"el-icon-share\",\n        path: \"/index/share\",\n        componentPath: \"/index/user/Share.vue\"\n      }]\n    }, {\n      name: \"MORE\",\n      icon: \"el-icon-more\",\n      child: [{\n        name: \"联系我们\",\n        icon: \"el-icon-chat-dot-square\",\n        path: \"/index/contact\",\n        componentPath: \"/index/more/Contact.vue\"\n      }, {\n        name: \"小程序服务\",\n        icon: \"el-icon-mobile\",\n        path: \"/index/more\",\n        componentPath: \"/index/more/Contact.vue\"\n      }]\n    }]; // 获取用户角色\n\n    var userState = store.state.userState; // 如果用户为管理员则添加数据后台\n\n    if (userState == 1) {\n      menu_data.splice(1, 1, {\n        name: \"DATA&TABLE\",\n        icon: \"el-icon-s-data\",\n        child: [{\n          name: \"用户管理\",\n          icon: \"el-icon-user-solid\",\n          path: \"/index/userManager\",\n          componentPath: \"/index/manager/UserManager.vue\"\n        }, {\n          name: \"书本管理\",\n          icon: \"el-icon-reading\",\n          path: \"/index/bookManager\",\n          componentPath: \"/index/manager/BookManager.vue\"\n        }]\n      });\n    }\n\n    store.commit(\"setMeunData\", menu_data); // 生成动态路由\n\n    buildRouter(); // 设置已经加载过的标记\n\n    store.commit(\"setLoadRoute\", true);\n  }\n\n  next();\n});\nexport default router;","map":{"version":3,"names":["Vue","Router","Login","Regist","Home","Index","axios","store","use","routes","path","component","redirect","children","router","mode","base","process","env","BASE_URL","oRoutes","options","buildRouter","data","state","menu_data","forEach","item","child","new_router","push","beforeEach","to","from","next","isLoadRoute","name","icon","componentPath","userState","splice","commit"],"sources":["D:/Work/Project/LMS/lms/src/router.js"],"sourcesContent":["import Vue from \"vue\";\nimport Router from \"vue-router\";\nimport Login from \"./components/user/Login.vue\";\nimport Regist from \"./components/user/Regist.vue\";\nimport Home from \"./components/Home.vue\";\nimport Index from \"./components/index/Index.vue\";\nimport axios from \"axios\";\nimport store from \"./store/store\";\n\nVue.use(Router);\n\nconst routes = [\n  {\n    path: \"/index\",\n    component: Index,\n    redirect: \"/index/profile\",\n    // 路由嵌套\n    children: [],\n  },\n  {\n    path: \"/\",\n    redirect: \"/home\",\n  },\n  {\n    path: \"/login\",\n    component: Login,\n  },\n  {\n    path: \"/regist\",\n    component: Regist,\n  },\n  {\n    path: \"/home\",\n    component: Home,\n  },\n];\n\nconst router = new Router({\n  mode: \"history\",\n  base: process.env.BASE_URL,\n  routes,\n});\n\nlet oRoutes = router.options.routes;\n\n// 生成动态路由\nconst buildRouter = () => {\n  let data = store.state.menu_data;\n  data.forEach((item) => {\n    item.child.forEach((child) => {\n      let new_router = {\n        path: child.path,\n        component: () => import(\"./components/index/Index.vue\"),\n      };\n      router.options.routes[0].children.push(new_router);\n    });\n  });\n};\n\nrouter.beforeEach((to, from, next) => {\n  // 判断路由是否已经加载过\n  // if (to != \"/index\") {\n  //   next();\n  // }\n  // console.log(to, from);\n  let isLoadRoute = store.state.isLoadRoute;\n  if (!isLoadRoute) {\n    // axios.get(\"/menuList\").then((res) => {\n    //   store.commit(\"setMeunData\", res.data, menu_data);\n    // });\n    const menu_data = [\n      {\n        name: \"USER\",\n        icon: \"el-icon-user\",\n        child: [\n          {\n            name: \"个人信息\",\n            icon: \"el-icon-document\",\n            path: \"/index/profile\",\n            componentPath: \"/index/user/Profile.vue\",\n          },\n          {\n            name: \"我的收藏\",\n            icon: \"el-icon-collection\",\n            path: \"/index/collection\",\n            componentPath: \"/index/user/Collection.vue\",\n          },\n          {\n            name: \"我的分享\",\n            icon: \"el-icon-share\",\n            path: \"/index/share\",\n            componentPath: \"/index/user/Share.vue\",\n          },\n        ],\n      },\n      {\n        name: \"MORE\",\n        icon: \"el-icon-more\",\n        child: [\n          {\n            name: \"联系我们\",\n            icon: \"el-icon-chat-dot-square\",\n            path: \"/index/contact\",\n            componentPath: \"/index/more/Contact.vue\",\n          },\n          {\n            name: \"小程序服务\",\n            icon: \"el-icon-mobile\",\n            path: \"/index/more\",\n            componentPath: \"/index/more/Contact.vue\",\n          },\n        ],\n      },\n    ];\n    // 获取用户角色\n    let userState = store.state.userState;\n    // 如果用户为管理员则添加数据后台\n    if (userState == 1) {\n      menu_data.splice(1, 1, {\n        name: \"DATA&TABLE\",\n        icon: \"el-icon-s-data\",\n        child: [\n          {\n            name: \"用户管理\",\n            icon: \"el-icon-user-solid\",\n            path: \"/index/userManager\",\n            componentPath: \"/index/manager/UserManager.vue\",\n          },\n          {\n            name: \"书本管理\",\n            icon: \"el-icon-reading\",\n            path: \"/index/bookManager\",\n            componentPath: \"/index/manager/BookManager.vue\",\n          },\n        ],\n      });\n    }\n    store.commit(\"setMeunData\", menu_data);\n    // 生成动态路由\n    buildRouter();\n    // 设置已经加载过的标记\n    store.commit(\"setLoadRoute\", true);\n  }\n  next();\n});\n\nexport default router;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}